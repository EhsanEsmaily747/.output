import{_ as B}from"./Nav.54df0d50.js";import{_ as R}from"./Nav.00826ed6.js";import V from"./Icon.deda8fe1.js";import{_ as D,w as N,t as U,z as q,r as f,k as d,c as g,b as e,g as k,v as E,A as z,F as j,f as M,d as x,u as p,e as H,h as A,a as w,p as K,m as L,n as Y,o as Z,x as G,l as S,P as J}from"./entry.dac6c7c1.js";import{u as y}from"./navBar.css.33dbc752.js";import{u as Q}from"./useImg.0e530899.js";/* empty css                 */import{u as X}from"./useAuth.55454f55.js";import"./config.ea43d4ee.js";const I=s=>(K("data-v-80178f07"),s=s(),L(),s),W={class:"container"},tt={class:"createPost"},et={class:"row"},ot=I(()=>e("label",{for:"Title"},"Title :",-1)),st={class:"row"},at=I(()=>e("label",{for:"Title"},"Subtitle :",-1)),nt={class:"row"},it=I(()=>e("label",{for:"Title"},"Content :",-1)),lt={class:"cats"},ct=I(()=>e("label",{for:"cat"},"Select One Category :",-1)),dt=["value","selected"],pt={class:"input-img"},rt={key:0,for:"img"},ut={key:1,class:"imgContainer"},_t=["src"],mt={__name:"EditPost",props:{post:Object,id:String},emits:["post-add","post-update"],async setup(s,{emit:r}){let l,u;const t=s,_=([l,u]=N(()=>y("http://api2.kdanish.com/api/v1/categories/","$eMKt4Rrual")),l=await l,u(),l);let m=U(_.data.value.list);const{file:i,generateUrl:T,uploadFile:v}=Q(),h=q(),C=async n=>{v(n)},b=f(),$=n=>{r("post-add",n),t.post.title=t.post.author=t.post.category=t.post.content=t.post.subtitle=t.post.picture=""},c=async()=>{if(t.post.editing){const n={title:t.post.title,subtitle:t.post.subtitle,content:t.post.content,picture:t.post.picture,category:t.post.category};t.post.editing=!1,$(n);try{await y(`http://api2.kdanish.com/api/v1/posts/${t.post._id}`,{method:"PUT",body:{updatedPost:n}},"$hhAtruYaHx")}catch(o){console.log(o)}}else{if(i.value){const o=Math.floor(Math.random()*1e13),{error:P,data:a}=await h.storage.from("Images").upload("public/"+o,i.value);b.value=`https://uhqrkikymwnejdgghkus.supabase.co/storage/v1/object/public/Images/${a.path}`}const n={title:t.post.title,subtitle:t.post.subtitle,author:t.id,content:t.post.content,picture:i.value?b.value:"/bg.jpg",category:t.post.category};$(n),i.value=null;try{console.log(n),await y("http://api2.kdanish.com/api/v1/posts/",{method:"POST",body:{newPost:n}},"$FPbyPpjyTX")}catch(o){console.log(o)}}};return(n,o)=>{const P=V;return d(),g("div",W,[e("form",tt,[e("div",et,[ot,k(e("input",{type:"text","onUpdate:modelValue":o[0]||(o[0]=a=>s.post.title=a),placeholder:"Post main title.."},null,512),[[E,s.post.title]])]),e("div",st,[at,k(e("input",{type:"text","onUpdate:modelValue":o[1]||(o[1]=a=>s.post.subtitle=a),placeholder:"Your feeling about post"},null,512),[[E,s.post.subtitle]])]),e("div",nt,[it,k(e("textarea",{name:"","onUpdate:modelValue":o[2]||(o[2]=a=>s.post.content=a),id:"Title",cols:"30",rows:"10",placeholder:"post content here...."},null,512),[[E,s.post.content]])]),e("div",lt,[ct,k(e("select",{name:"cat","onUpdate:modelValue":o[3]||(o[3]=a=>s.post.category=a),id:""},[(d(!0),g(j,null,M(p(m),a=>(d(),g("option",{value:a._id,selected:s.post.category},x(a.name),9,dt))),256))],512),[[z,s.post.category]])]),e("div",pt,[!p(i)&&!s.post.editing?(d(),g("label",rt,[H("+ "),e("input",{class:"file",type:"file",id:"img",onChange:o[4]||(o[4]=a=>C(a))},null,32)])):A("",!0),p(i)?(d(),g("div",ut,[e("img",{class:"uploadedImage",src:p(T)(p(i)),alt:""},null,8,_t),w(P,{class:"icon",name:"material-symbols:close",onClick:o[5]||(o[5]=a=>i.value=null)})])):A("",!0)])]),e("button",{onClick:c},x(s.post.editing?"Edit":"Add"),1)])}}},vt=D(mt,[["__scopeId","data-v-80178f07"]]);const ht={class:"main"},gt={class:"postbody"},yt={class:"title"},ft={class:"desc"},bt=["src"],$t={class:"options"},Pt={__name:"Post",props:{post:Object},emits:["delete-post"],setup(s,{emit:r}){const l=s,u=async()=>{r("delete-post",l.post._id);try{const t=await y(`http://localhost:5000/api/v1/posts/${l.post._id}`,{method:"DELETE"},"$zeJGdkdK51")}catch(t){console.log(t)}};return(t,_)=>{const m=V;return d(),g("div",ht,[e("div",{class:"post",onClick:_[0]||(_[0]=i=>("navigateTo"in t?t.navigateTo:p(Y))(`/PostPage-${l.post._id}`))},[e("div",gt,[e("p",yt,x(s.post.title),1),e("p",ft,x(s.post.content),1)]),e("img",{class:"postpic",src:s.post.picture,alt:""},null,8,bt)]),e("div",$t,[w(m,{class:"icon",name:"mdi-light:pencil",onClick:_[1]||(_[1]=i=>t.$emit("onUpdate",s.post._id))}),w(m,{class:"icon",name:"mdi-light:delete",onClick:u})])])}}},kt=D(Pt,[["__scopeId","data-v-bcad1d0c"]]);const xt={class:"Container"},wt={class:"posts"},It={__name:"EditPost-[id]",async setup(s){let r,l,u=f({});const{decode:t,getToken:_}=X();let m=f("");Z(()=>{m.value=_(),m.value&&(u.value=t(m.value))});const i=G(),T=([r,l]=N(()=>y(`http://api2.kdanish.com/api/v1/posts/?name=${i.params.id}`,"$Ss9hIZqI46")),r=await r,l(),r),v=f(U(T.data.value.posts)),h=f({title:"",subtitle:"",author:"",content:"",picture:"",category:"",editing:!1}),C=c=>{v.value.push(c)},b=c=>{const n=v.value.findIndex(o=>o._id==c);h.value=U(v.value.splice(n,1)),h.value=h.value[0],h.value.editing=!0,console.log(h.value)},$=async c=>{const n=v.value.findIndex(o=>o._id==c);v.value.splice(n,1),await y(`http://api2.kdanish.com/api/v1/posts/${c}`,"$DUZQlp688t")};return(c,n)=>{const o=B,P=R,a=vt,F=kt;return d(),g("div",null,[p(u).isAdmin?(d(),S(o,{key:0})):(d(),S(P,{key:1,id:p(u).id},null,8,["id"])),e("div",xt,[w(a,{post:p(h),id:(c._.provides[J]||c.$route).params.id,onPostAdd:C},null,8,["post","id"]),e("div",wt,[(d(!0),g(j,null,M(p(v),O=>(d(),S(F,{post:O,onOnUpdate:b,onDeletePost:$},null,8,["post"]))),256))])])])}}},jt=D(It,[["__scopeId","data-v-7b5cc715"]]);export{jt as default};
