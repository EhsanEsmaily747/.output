import{_ as ne,a as se,b as oe}from"./Signup.19f52b98.js";import{_ as ae}from"./Nav.00826ed6.js";import{_ as ie}from"./Nav.54df0d50.js";import V from"./Icon.deda8fe1.js";import{_ as D,k as u,c as C,b as n,d as r,l as w,h as j,x as le,r as v,o as ue,w as E,t as L,y as ce,u as e,a as m,q as N,T as O,e as M,g as S,s as U,n as de,F as me,f as _e,v as re,i as pe}from"./entry.dac6c7c1.js";import{u as k}from"./navBar.css.33dbc752.js";import{u as ve}from"./useAuth.55454f55.js";import{u as fe}from"./useModal.8b95bbe4.js";/* empty css                       */import"./CustomBtn.5376788d.js";import"./config.ea43d4ee.js";const he={class:"cmtcontainer"},ge={class:"cmtItem"},ke={class:"writer"},$e=["src"],xe={class:"name"},ye={class:"content"},we={__name:"Comment",props:{data:Object,user:String},setup(l){return(o,_)=>{const T=V;return u(),C("div",he,[n("div",ge,[n("div",ke,[n("img",{src:l.data.author.picture,alt:"",class:"picture"},null,8,$e),n("p",xe,r(l.data.author.username),1)]),n("p",ye,r(l.data.content),1),l.data.author._id==l.user?(u(),w(T,{key:0,name:"fluent:delete-48-filled",class:"icon",onClick:_[0]||(_[0]=p=>o.$emit("deleteCmt",l.data))})):j("",!0)])])}}},Ce=D(we,[["__scopeId","data-v-7a77da5b"]]);const Te={class:"context"},be={__name:"Text",props:{text:String,subTitle:String},setup(l){return(o,_)=>(u(),C("div",Te,[n("h3",null,r(l.subTitle),1),n("p",null,r(l.text),1)]))}},Ie=D(be,[["__scopeId","data-v-23c7f558"]]);const Pe={class:"container"},Le={class:"postTitle"},Ne={class:"writerinfo"},Oe=["src"],Se={class:"postImage"},De=["src"],Be={class:"icons"},Ye={key:0,style:{"margin-bottom":"1rem"}},Ae={class:"comment"},Ee={class:"input"},Me={__name:"PostPage-[id]",async setup(l){let o,_;const T=le(),p=v(!1),b=v(!1),a=v({}),c=v(""),{decode:R,getToken:F}=ve();ue(()=>{c.value=F(),c.value&&(a.value=R(c.value)),s.likes.includes(a.value.id)?p.value=!0:p.value=!1});const{loginopener:B,signupopener:Y,showLogin:$,showSign:A}=fe(),W=([o,_]=E(()=>k(`http://api2.kdanish.com/api/v1/posts/?id=${T.params.id}`,"$A1X9K6oEWZ")),o=await o,_(),o),s=L(W.data.value.posts[0]),q=([o,_]=E(()=>k(`http://api2.kdanish.com/api/v1/comments/?id=${s._id}`,"$rqgBuwjnY0")),o=await o,_(),o),z=L(q.data.value).comments;let f={};const x=v({likes:s.likes.length,comments:s.comments.length});c.value;const Z=async()=>{if(c.value){if(p.value){x.value.likes--,p.value=!1;const d=s.likes.indexOf(a.value.id);s.likes.splice(d,1)}else x.value.likes++,p.value=!0,s.likes.push(a.value.id);f=s,await k(`http://api2.kdanish.com/api/v1/posts/${s._id}`,{method:"PUT",body:{updatedPost:f}},"$OWzz97WoNj")}else alert("You must be Logged In"),$.value=!0},G=()=>{c.value?b.value=!b.value:(alert("You must be Logged In"),$.value=!0)},y=v(z);x.value.comments=ce(()=>y.value.length);const h=v(""),H=async()=>{if(c.value){let d={content:h.value,author:a.value.id,postId:T.params.id};const t=await k("http://api2.kdanish.com/api/v1/comments/",{method:"POST",body:{newCmt:d}},"$965GYsNhYw");console.log(t);const g=L(t.data.value).comment,I={author:{_id:a.value.id,username:a.value.name,picture:a.value.pic},_id:g._id,content:h.value};y.value.push(I),h.value="",f=s,f.comments.pop(),f.comments.push(g._id),await k(`http://api2.kdanish.com/api/v1/posts/${s._id}`,{method:"PUT",body:{updatedPost:f}},"$Oc6Qdj8slh")}else alert("You must be logged in"),$.value=!0},K=async d=>{const t=y.value.findIndex(g=>g._id==d._id);y.value.splice(t,1),await k(`http://api2.kdanish.com/api/v1/comments/${d._id}`,{method:"DELETE"},"$LN8dZm52Hv")};return(d,t)=>{const g=ne,I=ae,Q=ie,X=se,J=oe,P=V,ee=Ce,te=Ie;return u(),C("div",null,[e(c)?e(a).isAdmin?(u(),w(Q,{key:2})):(u(),w(I,{key:1,id:e(a).id,onSignOut:t[2]||(t[2]=i=>c.value=!1)},null,8,["id"])):(u(),w(g,{key:0,onOpenSign:t[0]||(t[0]=i=>e(Y)()),onOpenLogin:t[1]||(t[1]=i=>e(B)())})),m(O,{name:"fade"},{default:N(()=>[S(m(X,{onCloseModal:t[3]||(t[3]=i=>$.value=!1),onOpenRegister:t[4]||(t[4]=i=>e(Y)())},null,512),[[U,e($)]])]),_:1}),m(O,{name:"fade"},{default:N(()=>[S(m(J,{onCloseModal:t[5]||(t[5]=i=>A.value=!1),onOpenLogin:t[6]||(t[6]=i=>e(B)())},null,512),[[U,e(A)]])]),_:1}),n("div",Pe,[n("h2",Le,r(e(s).title),1),n("div",Ne,[n("img",{src:e(s).author.picture,class:"pimage",alt:""},null,8,Oe),n("p",{class:"user",onClick:t[7]||(t[7]=i=>("navigateTo"in d?d.navigateTo:e(de))(`/UserPage-${e(s).author._id}`))},r(e(s).author.username),1)]),n("div",Se,[n("img",{src:e(s).picture,alt:""},null,8,De),n("div",Be,[n("ul",null,[n("li",null,[m(P,{class:"icon",onClick:Z,name:e(p)?"mdi:like":"mdi:like-outline"},null,8,["name"]),M(r(e(x).likes),1)]),n("li",null,[m(P,{class:"icon",onClick:G,name:"memory:message"}),M(r(e(x).comments),1)])])])]),m(O,{name:"drop"},{default:N(()=>[e(b)?(u(),C("div",Ye,[n("section",Ae,[(u(!0),C(me,null,_e(e(y),i=>(u(),w(ee,{data:i,user:e(a).id,onDeleteCmt:K},null,8,["data","user"]))),256))]),n("div",Ee,[S(n("input",{class:"textInput",type:"text","onUpdate:modelValue":t[8]||(t[8]=i=>pe(h)?h.value=i:null)},null,512),[[re,e(h)]]),m(P,{class:"sendIcon",onClick:H,name:"lucide:send"})])])):j("",!0)]),_:1}),m(te,{text:e(s).content,subTitle:e(s).subtitle},null,8,["text","subTitle"])])])}}},Ke=D(Me,[["__scopeId","data-v-20ffd0c9"]]);export{Ke as default};
